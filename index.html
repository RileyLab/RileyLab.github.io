<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Riley Lab Portal</title>
  <link rel="shortcut icon" href="https://raw.githubusercontent.com/RileyLab/RileyLab.github.io/master/favicon.ico" />

  <!-- Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@300..700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#fff;
      --muted:#495057;
      --text:#111;
      --accent:#0057b7;
      --ring:rgba(0,87,183,.25);
      --link:#0b5ed7;
      --warn-bg:#fff8e1;
      --warn-border:#ffe082;
      --shadow:0 6px 18px rgba(0,0,0,.08);
      --shadow-hover:0 10px 26px rgba(0,87,183,.15);
      --radius:12px;
      --underline:linear-gradient(currentColor,currentColor);
    }
  
    html,body{height:100%}
    body{
      margin:0;
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:var(--bg);
    }
    body::before{
      content:""; position:fixed; inset:0;
      background:url("https://raw.githubusercontent.com/RileyLab/RileyLab.github.io/master/fav-background.png") center/cover no-repeat fixed;
      z-index:-2; filter:saturate(.9) contrast(1.02);
    }
    body::after{
      content:""; position:fixed; inset:0; z-index:-1;
      background:rgba(245,247,251,.86); backdrop-filter:blur(.5px);
    }
  
    /* Page frame */
    .wrap{ max-width:1440px; margin:0 auto; padding:28px 20px 60px }
  
    header{
      display:grid; grid-template-columns:1fr auto; align-items:end; gap:16px;
      margin:8px 0 16px;
    }
    .title{ font-size:clamp(24px,3.5vw,36px); font-weight:800; letter-spacing:.2px }
    .subtitle{ color:var(--muted); font-size:14px; margin-top:4px }
  
    /* Notice banner (toast) */
    .notice{
      display:none; align-items:center; gap:10px;
      background:var(--warn-bg); border:1px dashed var(--warn-border);
      color:#3b3b00; padding:10px 12px; border-radius:var(--radius); margin:0 0 16px;
    }
    .notice.show{ display:flex }
    .notice .close{ margin-left:auto; background:transparent; border:0; cursor:pointer; font-size:18px; line-height:1; color:#6c6c3a }
    .notice-fixed{
      position:fixed; top:20px; right:20px; width:280px; z-index:9999;
      background:#fff8e1; border:2px solid #ffca28; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,.15);
      padding:14px 16px; display:flex; align-items:flex-start; gap:10px; color:#3b3b00; font-weight:600; font-size:14px;
      opacity:0; transform:translateX(100%); transition:transform .5s ease, opacity .6s ease;
    }
    .notice-fixed.show{ opacity:1; transform:translateX(0); animation:pulseNotice 3s infinite }
    @keyframes pulseNotice{
      0%,100%{ box-shadow:0 0 0 0 rgba(255,193,7,.4) }
      50%{ box-shadow:0 0 0 6px rgba(255,193,7,0) }
    }
    .notice-fixed .ms{ font-size:22px; color:#ff8f00; flex-shrink:0 }
  
    /* Icon font */
    .ms{ font-family:"Material Symbols Rounded"; font-weight:400; font-style:normal; font-size:20px; line-height:1 }
  
    /* Search */
    .actions{ display:flex; gap:10px; align-items:center }
    .pill{ font-size:12px; padding:4px 10px; border-radius:999px; border:1px solid #ddd; color:var(--muted) }
    .search{
      display:flex; align-items:center; gap:8px; background:#fff; border:1px solid #dfe6ef;
      border-radius:999px; padding:8px 12px; box-shadow:0 2px 8px rgba(0,0,0,.04);
    }
    .search input{ border:0; outline:0; font:inherit; background:transparent; min-width:220px }
    .search:focus-within{ box-shadow:0 0 0 3px var(--ring) }
  
    /* === Three-column page layout: left sidebar | main grid | right sidebar === */
    .layout{
      display:grid; gap:20px;
      grid-template-columns:340px 1fr 320px;   /* adjust widths as desired */
      align-items:start;
    }
    /* collapse right sidebar below on medium screens */
    @media (max-width:1250px){
      .layout{ grid-template-columns:320px 1fr; }
      .rightbar{ grid-column:1 / -1; }  /* full width under main */
    }
    /* single column on small screens */
    @media (max-width:900px){
      .layout{ grid-template-columns:1fr; }
      .sidebar .card, .rightbar .card{ position:static; top:auto }
    }
  
    /* Sidebars stick to top row */
    .sidebar .card, .rightbar .card{ position:sticky; top:16px }
  
    /* Main grid (center column) */
    .grid{
      display:grid; gap:20px;
      grid-template-columns:repeat(3, minmax(300px, 1fr));
    }
    @media (max-width:1250px){
      .grid{ grid-template-columns:repeat(2, minmax(320px, 1fr)) }
    }
    @media (max-width:900px){
      .grid{ grid-template-columns:1fr }
    }
  
    /* Cards */
    .card{
      background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:18px; border:1px solid #e7e7e7; position:relative;
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .card:hover{ transform:translateY(-3px); box-shadow:var(--shadow-hover); border-color:#d6e3ff }
    @media (prefers-reduced-motion:reduce){
      .card{ transition:box-shadow .18s ease, border-color .18s ease }
      .card:hover{ transform:none }
    }
    .card h2{
      font-size:20px; letter-spacing:.3px; margin:-18px -18px 12px -18px; padding:14px 18px;
      border-radius:var(--radius) var(--radius) 0 0; color:#222; display:flex; align-items:center; gap:10px;
      box-shadow:inset 0 -1px 0 rgba(0,0,0,.08);
    }
    .card h2 .badge{ margin-left:auto }
    .badge{ display:inline-flex; align-items:center; gap:6px; font-size:12px; padding:3px 10px; border-radius:999px; background:#eef4ff; color:#143d8d; border:1px solid #d5e3ff }
  
    /* Section header colors */
    #cal-title{ background:#a8c8ff }
    #equip-title{ background:#a9e5c2 }
    #duties-title{ background:#ffe69b }
    #cores-title{ background:#f5a3a3 }
    #tools-title{ background:#9ee5f0 }
    #misc-title{ background:#ffcba4 }
  
    /* Lists & links */
    .list{ list-style:none; padding:0; margin:0 }
    .list li{ margin:8px 0 }
    .link{
      text-decoration:none; color:var(--link); font-weight:600; position:relative;
      display:inline-flex; align-items:center; gap:10px; padding:6px 10px;
      border-radius:8px; outline:none; border:1px solid transparent; transition:background .15s ease, border-color .15s ease;
    }
    .link::after{
      content:""; position:absolute; left:10px; right:10px; bottom:6px; height:2px;
      background:var(--underline); transform:scaleX(0); transform-origin:left; transition:transform .2s ease; opacity:.75;
    }
    .link:hover{ background:#eaf2ff; border-color:#cfe0ff }
    .link:hover::after{ transform:scaleX(1) }
    .link:focus{ box-shadow:0 0 0 3px var(--ring) }
    .ext::after{ content:none !important }
    .muted{ color:var(--muted); font-weight:500 }
  
    /* Details (disclosure) */
    details{ border:1px solid #ddd; border-radius:8px; padding:10px 12px; background:#fafafa }
    details[open]{ background:#e3f2fd }
    summary{
      cursor:pointer; list-style:none; font-weight:700; display:flex; align-items:center; gap:8px; position:relative; padding-left:20px;
    }
    summary::before{
      content:""; position:absolute; left:0; top:50%; transform:translateY(-50%) rotate(0);
      border-width:5px 0 5px 7px; border-style:solid; border-color:transparent transparent transparent #555; transition:transform .2s ease;
    }
    details[open] > summary::before{ transform:translateY(-50%) rotate(90deg) }
    summary .ms{ font-size:20px; line-height:1; position:relative; top:1px }
    summary::-webkit-details-marker{ display:none }
  
    /* Calendar sidebar */
    #live-cal-title{ background:#cfe0ff }
    .iframe-wrap{
      border:1px solid #e0e7ef; border-radius:10px; overflow:hidden; box-shadow:var(--shadow); background:#fff;
    }
    .iframe-wrap iframe{ width:100%; height:760px; border:0 }
    .calendar-toolbar{
      display:flex; gap:8px; align-items:center; margin:10px 0 12px;
    }
    .calendar-toolbar .btn{
      appearance:none; border:1px solid #d6e3ff; background:#f4f8ff; color:#0b3d91;
      padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:600;
    }
    .calendar-toolbar .btn[aria-pressed="true"]{ background:#e6efff; border-color:#bcd0ff }
  
    /* Announcements sidebar */
    #ann-title{ background:#ffe3b3 }
    .ann-list li{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px; border:1px solid #f4e1b8; border-radius:10px; background:#fffaf0;
      margin:10px 0;
    }
    .ann-time{ font-size:12px; color:#6b5d3b; font-weight:600; white-space:nowrap }
    .ann-text{ flex:1 }
  
    /* Footer */
    footer{ margin-top:26px; color:var(--muted); font-size:12px }
    .stack{ display:flex; gap:8px; flex-wrap:wrap }

    /* ==== Page centering + wider left calendar ==== */
    /* Tweakable variables */
    :root{
      --page-max: 1600px;   /* overall page width for centering */
      --gap: 22px;          /* space between columns/cards */
      --left: 460px;        /* LEFT sidebar (calendar) width */
    }
    
    /* Page wrapper — truly centered */
    .wrap{ max-width: var(--page-max); margin-inline: auto; }
    
    /* Top banner: Lab Announcements (full-width) */
    .ann-banner.card{ padding: 14px 16px; }
    #ann-banner-title{ background: #ffe3b3; }
    .ann-banner .ann-list{
      display: grid; gap: 10px; margin-top: 10px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .ann-banner .ann-list li{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px; border:1px solid #f4e1b8; border-radius:10px; background:#fffaf0;
    }
    .ann-time{ font-size:12px; color:#6b5d3b; font-weight:600; white-space:nowrap }
    .ann-text{ flex:1 }
    
    /* Two-column layout now: LEFT sidebar (calendar) + CENTER grid (cards) */
    .layout{
      display: grid; gap: var(--gap);
      grid-template-columns: var(--left) 1fr;
      align-items: start;
    }
    
    /* Make the calendar sticky and taller for the wider column */
    .sidebar .card{ position: sticky; top: 16px; }
    .iframe-wrap iframe{ height: 840px; }  /* was ~760-820, adjust if you like */
    
    /* Center grid: give cards more breathing room so badges don't overflow */
    .grid{
      display:grid; gap: var(--gap);
      grid-template-columns: repeat(3, minmax(340px, 1fr));   /* wider minimums */
    }
    
    /* Avoid header/badge overflow inside narrow cards */
    .card h2{ min-width: 0; display:flex; align-items:center; gap:10px; }
    .card h2 .badge{ flex-shrink: 0; }        /* keep the badge from squashing title */
    
    /* Responsive steps: 2 cols earlier, then stack */
    @media (max-width: 1450px){
      :root{ --left: 420px; --page-max: 1500px; }
      .grid{ grid-template-columns: repeat(2, minmax(340px, 1fr)); }
    }
    @media (max-width: 1000px){
      .layout{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: 1fr; }
      .sidebar .card{ position: static; top:auto; }
    }

    /* === LAB ANNOUNCEMENTS SPACING + POLISH === */
    .lab-announcements {
      margin-bottom: 28px;       /* space between announcements and rest of page */
      padding-bottom: 4px;
    }
    
    .lab-announcements .card {
      margin-bottom: 0;
    }
    
    /* If your announcements bar is full-width across top */
    .lab-announcements + .layout {
      margin-top: 12px;          /* adds a soft gap before the main grid starts */
    }
    
    /* Keep consistent alignment with page margins */
    .lab-announcements {
      max-width: var(--page-max);
      margin-left: auto;
      margin-right: auto;
    }
    
    /* Optional: slightly enhance background tone */
    .lab-announcements h2 {
      box-shadow: inset 0 -1px 0 rgba(0,0,0,0.05);
    }

    /* === SPACING BETWEEN ANNOUNCEMENTS AND MAIN LAYOUT === */
    .lab-announcements {
      display: block;
      margin-bottom: 28px;      /* creates visible space before grid */
    }
    
    .lab-announcements + .layout {
      margin-top: 28px;         /* ensures consistent vertical gap */
    }
    
    /* If announcements span full width, align with content and keep consistent width */
    .lab-announcements {
      max-width: var(--page-max);
      margin-left: auto;
      margin-right: auto;
      padding-bottom: 8px;
    }
    
    /* make the card slightly pop above the grid */
    .lab-announcements .card {
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    /* === Announcements banner spacing (matches: <section class="card ann-banner">) === */
    .card.ann-banner {
      display: block;
      margin: 0 0 28px 0;   /* <- the gap you want */
      padding-bottom: 8px;
      max-width: var(--page-max);
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06); /* optional pop */
    }
    
    /* If the banner sits directly above the main .layout, add extra safety gap */
    .card.ann-banner + .layout {
      margin-top: 28px;
    }

    /* === MATCH LAB CALENDAR HEIGHT TO TWO STACKED CARDS === */
    .sidebar .card#live-cal-card {
      height: calc((18px * 2) + (var(--card-height, 0px) * 2) + 40px); /* placeholder fallback */
    }
    
    /* Simpler and more reliable: match overall column height visually */
    .sidebar .card#live-cal-card {
      display: flex;
      flex-direction: column;
      height: 100%;
      min-height: 720px;    /* base height */
      max-height: 1000px;   /* cap for long screens */
    }
    
    /* Let the iframe expand to fill available space */
    .sidebar .iframe-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .sidebar .iframe-wrap iframe {
      flex: 1;
      height: 100%;
    }

    /* Calendar card fills the height we assign via JS */
    #live-cal-card{ display:flex; flex-direction:column; }
    #live-cal-card .iframe-wrap{ flex:1; min-height:0; }
    #live-cal-card .iframe-wrap iframe{ height:100%; }

    /* ===== Room Maintenance Rotations ===== */
    .room-rot #rot-title { background:#e6efff; }   /* light blue header to match your theme */
    
    .rot-grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }
    
    /* Colored headers like your screenshot */
    .rot-col{
      border:1px solid #e2e6ee;
      border-radius:10px;
      overflow:hidden;
      background:#fff;
      box-shadow: var(--shadow);
    }
    
    .rot-h{
      font-weight:800;
      color:#111;
      text-align:center;
      padding:8px 10px;
      border-bottom:1px solid rgba(0,0,0,.08);
      font-size:14px;
    }
    
    .rot-body{
      padding:10px 12px;
      text-align:center;
      font-weight:600;
    }
    
    /* palette */
    .rot-tc1 { background:#f8bf20; }   /* amber */
    .rot-tc2 { background:#5a84e8; color:#fff; }
    .rot-tc3 { background:#74b65a; color:#0f2a0f; }
    .rot-main{ background:#d32f2f; color:#fff; }
    
    /* Editor */
    .rot-edit{
      margin-top:12px;
      border:1px dashed #d8e1ff;
      border-radius:10px;
      padding:10px 12px;
      background:#f8fbff;
    }
    .rot-edit[open]{ background:#eef5ff; }
    
    .rot-form{ display:grid; gap:12px; }
    .rot-form .row{
      display:grid; gap:10px;
      grid-template-columns: repeat(4, minmax(0,1fr));
    }
    .rot-form label{ display:flex; flex-direction:column; gap:6px; font-weight:700; font-size:14px; }
    .rot-form input{
      border:1px solid #dfe6ef; border-radius:8px; padding:8px 10px; font:inherit; background:#fff;
    }
    .rot-form input:focus{ outline:none; box-shadow:0 0 0 3px var(--ring); }
    
    .rot-form .actions{ display:flex; gap:10px; align-items:center; }
    .btn-primary{
      appearance:none; border:1px solid #bcd0ff; background:#e6efff; color:#0b3d91;
      padding:8px 12px; border-radius:8px; font-weight:700; cursor:pointer;
    }
    .btn-ghost{
      appearance:none; border:1px solid #e0e7ef; background:#fff; color:#333;
      padding:8px 12px; border-radius:8px; font-weight:600; cursor:pointer;
    }
    .hint{ font-size:12px; color:#6b7280; }
    
    @media (max-width: 900px){
      .rot-form .row{ grid-template-columns: 1fr 1fr; }
    }

    /* Hide editor by default; show only in admin mode */
    .rot-edit { display: none; }
    body.admin .rot-edit { display: block; }
    
    /* Also visually disable inputs when not admin */
    .room-rot .rot-form input:disabled {
      background: #f4f6fa;
      color: #7a869a;
      cursor: not-allowed;
    }
    
    /* Tiny admin link (optional) */
    #admin-toggle {
      position: fixed;
      bottom: 14px;
      right: 16px;
      font-size: 12px;
      padding: 6px 8px;
      border: 1px solid #e0e7ef;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
      color: #475569;
      cursor: pointer;
      opacity: .6;
    }
    #admin-toggle:hover { opacity: 1; }

    .card.room-rot {
      display:block;
      max-width: var(--page-max);
      margin: 16px auto 28px;   /* top gap from announcements, bottom gap from grid */
    }
    
    /* Extra safety if it sits directly under the announcements banner */
    .card.ann-banner + .card.room-rot {
      margin-top: 18px;
    }
    
  </style>

</head>
<body>
<div class="wrap">

  <!-- Live Notice Banner -->
  <div id="notice" class="notice notice-fixed" role="status" aria-live="polite">
    <span class="ms" aria-hidden="true">campaign</span>
    <div id="notice-text">Loading…</div>
  </div>

  <header>
    <div>
      <div class="title">Riley Lab Portal</div>
      <div class="subtitle">Riley Lab essentials all in one place</div>
    </div>

    <div class="actions">
      <div class="search" role="search">
        <span class="ms" aria-hidden="true">search</span>
        <input id="q" type="search" placeholder="Quick find links…" aria-label="Search links">
      </div>
      <span class="pill">Updated</span>
      <span class="pill">v1.1</span>
    </div>
  </header>

<section class="card ann-banner" aria-labelledby="ann-banner-title">
  <h2 id="ann-banner-title">
    <span class="ms" aria-hidden="true">campaign</span> Lab Announcements
  </h2>
  <ul id="ann-banner-list" class="list ann-list"></ul>
</section>

<section class="card room-rot" id="rotations-card" aria-labelledby="rot-title">
  <h2 id="rot-title">
    <span class="ms" aria-hidden="true">cleaning_services</span>
    Room Maintenance Rotations
    <span class="badge" id="rot-dates"></span>
  </h2>

  <!-- Display grid -->
  <div class="rot-grid" id="rot-grid">
    <!-- Filled by JS -->
  </div>

  <!-- Inline editor (collapsible) -->
  <details class="rot-edit" id="rot-edit">
    <summary><span class="ms" aria-hidden="true">edit</span> Update assignments</summary>

    <form id="rot-form" class="rot-form">
      <div class="row">
        <label>
          Start
          <input type="date" name="start" required>
        </label>
        <label>
          End
          <input type="date" name="end" required>
        </label>
      </div>

      <div class="row">
        <label>TC1 <input type="text" name="tc1" placeholder="Name"></label>
        <label>TC2 <input type="text" name="tc2" placeholder="Name"></label>
        <label>TC3 <input type="text" name="tc3" placeholder="Name"></label>
        <label>Main Lab <input type="text" name="main" placeholder="Name"></label>
      </div>

      <div class="actions">
        <button type="submit" class="btn-primary"><span class="ms" aria-hidden="true">save</span> Save</button>
        <button type="button" id="rot-clear" class="btn-ghost"><span class="ms" aria-hidden="true">restart_alt</span> Clear</button>
      </div>
      <div class="hint">Tip: updates are saved in your browser (localStorage).</div>
    </form>
  </details>
</section>
  
<div class="layout">
  <!-- LEFT: sidebar calendar -->
  <aside class="sidebar" aria-label="Lab calendar">
    <section class="card" id="live-cal-card" aria-labelledby="live-cal-title">
      <h2 id="live-cal-title"><span class="ms" aria-hidden="true">calendar_month</span> Riley Lab Calendar</h2>

      <div class="calendar-toolbar" role="toolbar" aria-label="Calendar view">
        <button class="btn" data-view="AGENDA" aria-pressed="false">Agenda</button>
        <button class="btn" data-view="WEEK"   aria-pressed="false">Week</button>
        <button class="btn" data-view="MONTH"  aria-pressed="true">Month</button>
      </div>
      
      <div class="iframe-wrap" style="margin-top:10px">
        <iframe
          title="Riley Lab Google Calendar"
          loading="lazy"
          src="https://calendar.google.com/calendar/embed?src=j27deqargjjbeg5835162djbl8%40group.calendar.google.com&ctz=America%2FNew_York&mode=MONTH&showPrint=0&showTabs=0&showCalendars=0&showTitle=0&showTz=0&wkst=1&bgcolor=%23ffffff">
        </iframe>
      </div>

      <div class="stack" style="margin-top:10px">
        <a class="link ext" href="https://calendar.google.com/calendar/embed?src=j27deqargjjbeg5835162djbl8%40group.calendar.google.com&ctz=America%2FNew_York" target="_blank" rel="noopener">
          <span class="ms" aria-hidden="true">open_in_new</span> Open full calendar
        </a>
      </div>
    </section>
  </aside>

  <main class="grid" aria-label="Link groups">

    <section class="card" id="card-calendars-hood" aria-labelledby="...">
      <h2 id="cal-title"><span class="ms" aria-hidden="true">event</span> Calendars/Hood Bookings <span class="badge"><span class="ms" aria-hidden="true">calendar_month</span>Bookings</span></h2>
      <ul class="list" style="margin-top:10px">
        <li><a class="link ext" href="https://www.brownbearsw.com/cal/RNAFortessa" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">schedule</span> Fortessa <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
      </ul>
      <details>
        <summary><span class="ms" aria-hidden="true">lab_profile</span> Riley Lab Hood Bookings</summary>
        <ul class="list" aria-label="Riley Lab Hood Bookings list">
          <li><a class="link ext" href="https://www.brownbearsw.com/cal/HIVRoom" target="_blank" rel="noopener">TC1 <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
          <li><a class="link ext" href="https://www.brownbearsw.com/cal/CancerRoom" target="_blank" rel="noopener">TC2 <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
          <li><a class="link ext" href="https://www.brownbearsw.com/cal/translationalroom" target="_blank" rel="noopener">TC3 <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        </ul>
      </details>
    </section>

    <section class="card" aria-labelledby="equip-title">
      <h2 id="equip-title"><span class="ms" aria-hidden="true">biotech</span> Shared Use Equipment <span class="badge"><span class="ms" aria-hidden="true">group</span>Shared</span></h2>
      <ul class="list">
        <li><a class="link ext" href="https://med-upenn.corefacilities.org/service_center/show_external/5381/small_animal_radiation_core_sarc" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">radiology</span> Irradiator <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://med-upenn.corefacilities.org/sc/6469/i3h-service-center?tab=equipment" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">science</span> 3600 CCB Ultra Centrifuge <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://teamup.com/kssvtmecq8agaw4phy" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">monitor_heart</span> xCELLigence <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://pathbio.med.upenn.edu/flow/shiner/Calendars/home" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">waterfall_chart</span> Fortessa Flow Core Scheduler <span class="muted">(use only to prevent Bill from turning off LSRFortessa E TRC 8-183)</span> <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
      </ul>
    </section>

    <section class="card" aria-labelledby="duties-title">
      <h2 id="duties-title"><span class="ms" aria-hidden="true">assignment_turned_in</span> Lab Duties <span class="badge"><span class="ms" aria-hidden="true">change_circle</span>Rotations</span></h2>
      <ul class="list">
        <li><a class="link ext" href="https://www.brownbearsw.com/cal/293T" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">coronavirus</span> 293T Cells <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
      </ul>
      <details>
        <summary><span class="ms" aria-hidden="true">cleaning_services</span> Room Maintenance Rotations</summary>
        <ul class="list" aria-label="Riley Lab Hood Bookings list">
          <li><a class="link ext" href="https://www.brownbearsw.com/mc/Riley/TC1Restocking" target="_blank" rel="noopener">TC1 Duty <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
          <li><a class="link ext" href="https://www.brownbearsw.com/mc/Riley/TC2Restocking" target="_blank" rel="noopener">TC2 Duty <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
          <li><a class="link ext" href="https://www.brownbearsw.com/mc/Riley/TC3Restocking" target="_blank" rel="noopener">TC3 Duty <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
          <li><a class="link ext" href="https://www.brownbearsw.com/mc/Riley/mainlabduty" target="_blank" rel="noopener">Main Lab Duty <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        </ul>
      </details>
    </section>

    <section class="card" id="card-upenn-cores" aria-labelledby="cores-title">
      <h2 id="cores-title"><span class="ms" aria-hidden="true">hub</span> UPenn Cores <span class="badge"><span class="ms" aria-hidden="true">category</span>Cores</span></h2>
      <ul class="list">
        <li><a class="link ext" href="https://www.med.upenn.edu/apps/my/index.php?_app_id=5ecffaaf109d6&_display=1&_hist_id=1&_preserve[init_panel]=dnacore%2Fmain&_token=5fb240a6e9f15f8adf144d9632c2fc81&CEALID=6B037AA7C0FFD4D899C03C18B4E98342&_token=3adca2be899805c397f63c7bf0dbfdb8" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">genetics</span> Penn Sequencing Core <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://pathbio.med.upenn.edu/hic/hiccell/" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">bloodtype</span> HIC Cell Ordering <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://pathbio.med.upenn.edu/duars/EntreeServer/" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">analytics</span> Flow Core Data <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://pathbio.med.upenn.edu/saif/EntreeServer/" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">pets</span> Mouse Imaging Data <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://genetics.med.upenn.edu/cores/cell-center-stockroom/" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">inventory_2</span> Cell Center Stockroom <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://med-upenn.corefacilities.org/homepage/" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">lab_research</span> iLab (Xenograft Core) <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
      </ul>
    </section>

    <section class="card" aria-labelledby="tools-title">
      <h2 id="tools-title"><span class="ms" aria-hidden="true">construction</span> Tools & Docs <span class="badge"><span class="ms" aria-hidden="true">star</span>Essentials</span></h2>
      <ul class="list">
        <li><a class="link ext" href="https://forms.gle/mNc43ejEpeXRTfYV9" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">assignment_add</span> Riley Lab Ordering Form <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://docs.google.com/spreadsheets/d/1EWxp0SgVXKpk8jPVvy0lLlk8iD1QHOZ_Ocj8JSMj218/edit?usp=sharing" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">table_chart</span> Order Statuses (Google Sheet) <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://penno365-my.sharepoint.com/:o:/g/personal/rileyj_upenn_edu/EreHrOPLVsBMhp_VD8rdvDwBXswkXTZpRWzQqIWqfsGnzA?e=08zM26" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">book_4</span> Riley Lab OneNote <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://lims.pmacs.upenn.edu/limsprod/logon.jsp" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">dns</span> LabVantage <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://upenn.app.box.com/file/878046376947" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">inventory</span> Plasmid &amp; Bacterial Stock List.xls <span class="muted">(Box)</span> <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://upenn.app.box.com/folder/132773147650" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">folder_zip</span> Plasmid DNA SnapGene Files <span class="muted">(Box)</span> <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
      </ul>
    </section>

    <section class="card" aria-labelledby="misc-title">
      <h2 id="misc-title"><span class="ms" aria-hidden="true">link</span> Other Resources <span class="badge"><span class="ms" aria-hidden="true">handyman</span>Handy</span></h2>
      <ul class="list">
        <li><a class="link ext" href="http://apps.brownbearsw.com/iobee/FlowJo" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">key</span> FlowJo Dongles <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://rileylabworkspace.slack.com/" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">chat</span> Riley Lab Slack <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://app.quartzy.com/groups/201349/requests?status" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">shopping_cart</span> Riley Lab Quartzy <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
        <li><a class="link ext" href="https://calendar.med.upenn.edu/cci/secure/mrbs/index.php" target="_blank" rel="noopener"><span class="ms" aria-hidden="true">speed</span> Smilow Ultra Centrifuge <span class="ms arrow" aria-hidden="true">arrow_outward</span></a></li>
      </ul>
    </section>

  </main>
  
</div>

  <footer>
    <div>Riley Lab™</div>
    <div>Updated and maintained by Max Eldabbas</div>
  </footer>
</div>

<button id="admin-toggle" type="button" title="Admin mode (Shift+A)">Admin</button>

<script>
  /* === CALENDAR VIEW TOGGLE (Agenda / Week / Month) === */
  (() => {
    const iframe = document.querySelector('.sidebar .iframe-wrap iframe');
    if (!iframe) return;

    const btns = Array.from(document.querySelectorAll('.calendar-toolbar .btn'));

    const params = new URLSearchParams({
      src: 'j27deqargjjbeg5835162djbl8@group.calendar.google.com',
      ctz: 'America/New_York',
      showPrint: '0',
      showTabs: '0',
      showCalendars: '0',
      showTitle: '0',
      showTz: '0',
      wkst: '1',
      bgcolor: '#ffffff'
    });
    const BASE = `https://calendar.google.com/calendar/embed?${params.toString()}&mode=`;

    const saved = localStorage.getItem('labCalView') || 'MONTH';
    setView(saved, false);

    btns.forEach(b => {
      b.addEventListener('click', () => setView(b.dataset.view || 'MONTH', true));
    });

    function setView(view, fromClick){
      btns.forEach(x => x.setAttribute('aria-pressed', String((x.dataset.view || '') === view)));
      iframe.src = BASE + encodeURIComponent(view);
      if(fromClick) localStorage.setItem('labCalView', view);
    }
  })();


  /* === QUICK FIND (limit to center grid ONLY) === */
  const q = document.getElementById('q');
  const linkItems = Array.from(document.querySelectorAll('main.grid .list a'));
  const sections  = Array.from(document.querySelectorAll('main.grid section.card'));

  function normalize(s){ return s.toLowerCase().replace(/\s+/g,' ').trim(); }

  q.addEventListener('input', () => {
    const term = normalize(q.value);
    if(!term){
      sections.forEach(sec => sec.style.display = '');
      linkItems.forEach(a => a.parentElement.style.display = '');
      return;
    }
    sections.forEach(sec => sec.style.display = 'none');
    linkItems.forEach(a => {
      const text = normalize(a.textContent);
      const match = text.includes(term);
      a.parentElement.style.display = match ? '' : 'none';
      if(match){
        const section = a.closest('section.card');
        if(section) section.style.display = '';
        const details = a.closest('details');
        if(details && !details.open) details.open = true;
      }
    });
  });


  /* === LAB ANNOUNCEMENTS (right sidebar only) === */

  // Use window.NOTICES so it’s editable later
  window.NOTICES = window.NOTICES || [
    { text: "Label printer is now functional and ready to print!", when: "2025-10-16T09:00:00-04:00" },
    { text: "Please check out the new Maintenance Rotations links to view when you are scheduled!", when: "2025-10-16T12:00:00-04:00" },
  ];

  function normalizeNotices(arr){
    return (arr || []).map(n =>
      (typeof n === 'string')
        ? { text: n, when: new Date().toISOString() }
        : { text: n.text || '', when: n.when || new Date().toISOString() }
    );
  }

  function renderAnnouncements(){
    const list = document.getElementById('ann-banner-list');
    if(!list) return;
    const items = normalizeNotices(window.NOTICES)
      .sort((a,b) => new Date(b.when) - new Date(a.when)); // newest first

    const frag = document.createDocumentFragment();
    items.forEach(({text, when})=>{
      const li   = document.createElement('li');
      const time = document.createElement('div');
      const body = document.createElement('div');
      time.className = 'ann-time';
      body.className = 'ann-text';

      const d = new Date(when);
      time.textContent = isNaN(d.getTime()) ? "" :
        d.toLocaleDateString(undefined, { month:'short', day:'numeric' });

      body.textContent = text;
      li.appendChild(time);
      li.appendChild(body);
      frag.appendChild(li);
    });
    list.innerHTML = "";
    list.appendChild(frag);
  }

  // Helper to add at runtime
  window.addAnnouncement = function(text, when){
    window.NOTICES.push({ text, when: when || new Date().toISOString() });
    renderAnnouncements();
  };

  // Initialize announcements sidebar
  renderAnnouncements();

  // Example:
  // addAnnouncement("Freezer maintenance Tue 10am", "2025-10-21T10:00:00-04:00");

  function syncCalendarHeight(){
    const calCard   = document.getElementById('live-cal-card');
    const topCard   = document.getElementById('card-calendars-hood');
    const bottomCard= document.getElementById('card-upenn-cores');
    if(!calCard || !topCard || !bottomCard) return;
  
    // Row gap from the center grid (so spacing matches your CSS)
    const grid   = topCard.closest('.grid');
    const rowGap = grid ? parseFloat(getComputedStyle(grid).rowGap || '0') : 0;
  
    // Total target = top card + gap + bottom card
    const target = topCard.offsetHeight + rowGap + bottomCard.offsetHeight;
  
    // Apply to the calendar card
    calCard.style.height = target + 'px';
  
    // Make the iframe area consume the remaining space inside the card
    const head    = calCard.querySelector('h2');
    const toolbar = calCard.querySelector('.calendar-toolbar');
    const padding = 18 * 2; // your .card padding (top+bottom)
    const extra   = (head?.offsetHeight || 0) + (toolbar?.offsetHeight || 0) + padding;
  
    const wrap = calCard.querySelector('.iframe-wrap');
    if (wrap) {
      wrap.style.height = Math.max(200, target - extra) + 'px';
      const iframe = wrap.querySelector('iframe');
      if (iframe) iframe.style.height = '100%';
    }
  }
  
  // Run on load and on resize (debounced)
  window.addEventListener('load',  syncCalendarHeight);
  window.addEventListener('resize', () => {
    clearTimeout(syncCalendarHeight._t);
    syncCalendarHeight._t = setTimeout(syncCalendarHeight, 120);
  });
  
  // If your details/accordions expand/collapse inside those center cards,
  // re-sync after a short delay:
  document.addEventListener('toggle', (e) => {
    if (e.target.tagName === 'DETAILS') setTimeout(syncCalendarHeight, 120);
  }, true);

  // ===== Room Maintenance Rotations (front-end editable) =====
  (function initRoomRotations(){
    const KEY = 'room-maintenance-rotations';
  
    // Default content (edit as you like)
    const DEFAULT = {
      start: new Date(),                         // today
      end:   new Date(Date.now() + 7*864e5),     // +7 days
      tc1:   '—',
      tc2:   '—',
      tc3:   '—',
      main:  '—'
    };
  
    const elDates   = document.getElementById('rot-dates');
    const elGrid    = document.getElementById('rot-grid');
    const form      = document.getElementById('rot-form');
    const btnClear  = document.getElementById('rot-clear');
    const details   = document.getElementById('rot-edit');
  
    if(!elGrid || !form) return;
  
    // Helpers
    const fmt = (d) => new Date(d).toLocaleDateString(undefined, { month:'short', day:'numeric', year:'numeric' });
    function load(){
      const raw = localStorage.getItem(KEY);
      if(!raw) return { ...DEFAULT };
      try{
        const obj = JSON.parse(raw);
        obj.start = obj.start || DEFAULT.start;
        obj.end   = obj.end   || DEFAULT.end;
        return obj;
      }catch{ return { ...DEFAULT }; }
    }
    function save(state){
      localStorage.setItem(KEY, JSON.stringify(state));
    }
  
    function render(state){
      // Dates badge
      const s = new Date(state.start), e = new Date(state.end);
      elDates.textContent = `${fmt(s)} – ${fmt(e)}`;
  
      // Grid html
      elGrid.innerHTML = `
        <div class="rot-col">
          <div class="rot-h rot-tc1">TC1</div>
          <div class="rot-body">${escapeHtml(state.tc1 || '—')}</div>
        </div>
        <div class="rot-col">
          <div class="rot-h rot-tc2">TC2</div>
          <div class="rot-body">${escapeHtml(state.tc2 || '—')}</div>
        </div>
        <div class="rot-col">
          <div class="rot-h rot-tc3">TC3</div>
          <div class="rot-body">${escapeHtml(state.tc3 || '—')}</div>
        </div>
        <div class="rot-col">
          <div class="rot-h rot-main">Main Lab</div>
          <div class="rot-body">${escapeHtml(state.main || '—')}</div>
        </div>
      `;
  
      // Form values
      form.start.value = toInputDate(s);
      form.end.value   = toInputDate(e);
      form.tc1.value   = state.tc1 || '';
      form.tc2.value   = state.tc2 || '';
      form.tc3.value   = state.tc3 || '';
      form.main.value  = state.main || '';
    }
  
    function toInputDate(d){
      const dt = new Date(d);
      const m = String(dt.getMonth()+1).padStart(2, '0');
      const da= String(dt.getDate()).padStart(2, '0');
      return `${dt.getFullYear()}-${m}-${da}`;
    }
  
    function escapeHtml(s){
      return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }
  
    const state = load();
    render(state);
  
    // Save
    form.addEventListener('submit', e => {
      e.preventDefault();
      const data = new FormData(form);
      state.start = data.get('start');
      state.end   = data.get('end');
      state.tc1   = data.get('tc1')?.trim();
      state.tc2   = data.get('tc2')?.trim();
      state.tc3   = data.get('tc3')?.trim();
      state.main  = data.get('main')?.trim();
      save(state);
      render(state);
      // close editor
      if(details && details.open) details.open = false;
    });
  
    // Clear
    btnClear.addEventListener('click', () => {
      localStorage.removeItem(KEY);
      Object.assign(state, { ...DEFAULT });
      render(state);
    });
  })();

  // ===== Admin Mode (front-end gating) =====
  // 1) Set a passphrase hash below (SHA-256 hex). Generate once in browser console:
  //    const d=new TextEncoder().encode("YOUR_SECRET"); crypto.subtle.digest("SHA-256", d)
  //      .then(b=>Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,"0")).join(""))
  const ADMIN_HASH = "454b3e5afda744a41f110c12298e6dddbe094129a3c61be533c7e944b7e8de51"; // <-- replace!
  
  const ADMIN_FLAG_KEY = "isAdmin";
  const $adminToggle = document.getElementById("admin-toggle");
  
  function setAdminUI(enabled) {
    document.body.classList.toggle("admin", !!enabled);
    // Disable/enable the rotations form inputs & buttons
    const form = document.getElementById("rot-form");
    if (form) {
      const disabled = !enabled;
      form.querySelectorAll("input,button").forEach(el => {
        // Keep the "Lock" button enabled when admin is on (we add it below)
        if (el.id === "admin-lock") return;
        el.disabled = disabled;
      });
    }
  }
  
  async function sha256Hex(text) {
    const data = new TextEncoder().encode(text);
    const buf = await crypto.subtle.digest("SHA-256", data);
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
  }
  
  async function unlockAdmin() {
    const pass = prompt("Enter admin passphrase:");
    if (!pass) return;
    const hash = await sha256Hex(pass);
    if (hash === ADMIN_HASH) {
      localStorage.setItem(ADMIN_FLAG_KEY, "1");
      setAdminUI(true);
      alert("Admin mode enabled.");
    } else {
      alert("Incorrect passphrase.");
    }
  }
  
  function lockAdmin() {
    localStorage.removeItem(ADMIN_FLAG_KEY);
    setAdminUI(false);
    alert("Admin mode disabled.");
  }
  
  // Init on load
  (function initAdmin(){
    const enabled = localStorage.getItem(ADMIN_FLAG_KEY) === "1";
    setAdminUI(enabled);
  
    // Keyboard shortcut: Shift + A
    document.addEventListener("keydown", (e) => {
      if (e.shiftKey && (e.key === "A" || e.key === "a")) {
        if (localStorage.getItem(ADMIN_FLAG_KEY) === "1") {
          lockAdmin();
        } else {
          unlockAdmin();
        }
      }
    });
  
    // Toggle button
    if ($adminToggle) {
      $adminToggle.addEventListener("click", () => {
        if (localStorage.getItem(ADMIN_FLAG_KEY) === "1") {
          lockAdmin();
        } else {
          unlockAdmin();
        }
      });
    }
  
    // Add a "Lock" button inside the editor when admin is active
    const form = document.getElementById("rot-form");
    if (form && !document.getElementById("admin-lock")) {
      const lockBtn = document.createElement("button");
      lockBtn.type = "button";
      lockBtn.id = "admin-lock";
      lockBtn.className = "btn-ghost";
      lockBtn.innerHTML = '<span class="ms" aria-hidden="true">lock</span> Lock';
      const actions = form.querySelector(".actions");
      if (actions) actions.appendChild(lockBtn);
      lockBtn.addEventListener("click", lockAdmin);
    }
  })();

</script>

</body>
</html>



































